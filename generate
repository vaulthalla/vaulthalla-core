#!/bin/bash

set -e

if [ $# -eq 0 ]; then
  echo "Usage: ./generate_cpp_module.sh <module/path/Name>"
  exit 1
fi

INPUT_PATH=$1
ROOT_SRC="./src"
ROOT_INCLUDE="./include"

# Extract the file base name and path
FILENAME=$(basename "$INPUT_PATH")
DIRPATH=$(dirname "$INPUT_PATH")

# Convert to PascalCase Namespace
NAMESPACE=$(echo "$DIRPATH" | tr '/' ' ' | awk '{for(i=1;i<=NF;++i) $i=toupper(substr($i,1,1)) substr($i,2)} 1' | tr ' ' ':')

# Create directories
mkdir -p "$ROOT_SRC/$DIRPATH"
mkdir -p "$ROOT_INCLUDE/$DIRPATH"

# Define file paths
CPP_FILE="$ROOT_SRC/$DIRPATH/$FILENAME.cpp"
HPP_FILE="$ROOT_INCLUDE/$DIRPATH/$FILENAME.hpp"

# Generate .hpp
cat <<EOF > "$HPP_FILE"
#pragma once

namespace $NAMESPACE {
class $FILENAME {
public:
    $FILENAME();
    ~$FILENAME();
};
}
EOF

# Generate .cpp
cat <<EOF > "$CPP_FILE"
#include "$DIRPATH/$FILENAME.hpp"

namespace $NAMESPACE {

$FILENAME::$FILENAME() {
    // TODO: Constructor
}

$FILENAME::~$FILENAME() {
    // TODO: Destructor
}

}
EOF

echo "âœ… Created C++ module: $FILENAME"
echo "   - $HPP_FILE"
echo "   - $CPP_FILE"
